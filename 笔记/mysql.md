# mysql

#### mysql基本组成

server层：

- 连接池：每次建立与断开连接需要消耗时间。连接池将这些连接缓存下来，方便下次直接使用

- 管理工具与服务：系统的管理合控制工具

- sql接口：接受sql命令，返回结果

- 解析器：解析sql命令

- 优化器：优化sql语句

- 缓存器：缓存命中的查询结构，下次直接返回

  **tip：在8.0开始不再使用缓存。因为基准测试发现，缓存造成的问题大于解决的问题**

存储引擎（下面细讲）：

- 数据的存储和提取（不同的存储引擎使用同一个server）

#### 一条sql的执行记录

- 查询语句：缓存是否命中->解析查询->优化->执行查询

#### 存储引擎

mysql区别于其他数据库的一个最重要的一点是可以自定义存储引擎（插件式），比如innoDB.

innoDB：mysql5.7后默认事务性引擎。支持事务

myISAm：5.1之前版本默认存储引擎。MyISAM提供了大量的特性，包括全文索引、压缩、空间函数（GIS）等，但MyISAM不支持事务和行级锁，而且崩溃后无法安全恢复。

区别：        

- 主外键：myISAm：不支持             innoDB：支持
- 事务：myISAm：不支持             innoDB：支持
- 行表锁：myISAm：支持表锁             innoDB：支持行表锁
- 关注点：myISAm：性能             innoDB：事务
- 索引：myISAm：索引与数据分开存储    innoDB：索引和数据存储在一起。

#### 日志文件

- 错误日志（error log）：mysql的启动运行关闭
- 慢查询日志（slow query log）：sql慢的查询，默认off
- 查询日志（query log）：记录了所有对MySQL数据库请求的信息，无论这些请求是否得到了正确的执行。
- 二进制文件（bin log）：记录所有ddl，dml语句（除了select语句）

#### 范式

第一范式：字段属性不可分割（如：字段 name_age 可分为name和age）

第二范式：字段属性完全依赖于主关键字

第三范式：表中每个字段都与主键直接有关，而不是间接

#### 索引

数据结构角度分为：b+树索引，哈希索引，fullText索引和R-TTree索引


##### hash索引和b+tree索引的区别

hash索引无法实现范围查找，排序，模糊查询等功能

使用场景：

若字段会出现大量重复数据、检索需要排序、分组、范围查询、模糊查询等操作，hash无法满足要求，建议使用B+Tree.

在离散型高，数据基数大，且等值查询得时候，Hash索引有优势。

##### 优化

[https://blog.csdn.net/qq_40068304/article/details/121520902](https://blog.csdn.net/qq_40068304/article/details/121520902)

1.避免使用 select *

2.小标驱动大表

3.大量数据批量操作（勿一条条插入）

4.若不要求全部数据多使用limit

5.join的表尽量控制在2-3个表

6.避免索引失效

##### 是否可以建立索引

将经常需要查询，排序，分组，联合操作的字段建立索引。字段尽量设置不为null。索引列上不进行计算。

##### 索引失效场景

1.  不满足最左前缀原则

2.  使用select *

3.  索引列上使用的函数

4.  索引字段使用is null

5.  like查询左边有%

6.  字符类型未加引号